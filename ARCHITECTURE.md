# webRocord ç³»ç»Ÿæ¶æ„

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æµè§ˆå™¨                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å‰ç«¯åº”ç”¨ (application)                        â”‚   â”‚
â”‚  â”‚              Vue 3 + Vite + rrweb                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
â”‚  â”‚  â”‚ é¦–é¡µ    â”‚  â”‚ è¡¨å•é¡µ   â”‚  â”‚ å½•åˆ¶    â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚         â”‚â”€â–¶â”‚         â”‚â”€â–¶â”‚ &å›æ”¾   â”‚                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTP POST /api/recording/save
                     â”‚ HTTP GET  /api/recording/list
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    åç«¯æœåŠ¡å™¨ (server)            â”‚
    â”‚    Express + Node.js             â”‚
    â”‚                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  API Routes                â”‚ â”‚
    â”‚  â”‚  - /api/recording/*        â”‚ â”‚
    â”‚  â”‚  - /api/playback/*         â”‚ â”‚
    â”‚  â”‚  - /health                 â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚           â”‚                      â”‚
    â”‚           â–¼                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  æ•°æ®å­˜å‚¨å±‚                 â”‚ â”‚
    â”‚  â”‚  - JSON æ–‡ä»¶å­˜å‚¨            â”‚ â”‚
    â”‚  â”‚  - ç´¢å¼•ç®¡ç†                 â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  data/          â”‚
            â”‚  recordings/    â”‚
            â”‚  â”œâ”€ index.json  â”‚
            â”‚  â”œâ”€ uuid-1.json â”‚
            â”‚  â””â”€ uuid-2.json â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  è§†é¢‘è½¬æ¢æœåŠ¡ (rrwebToMp4)       â”‚
    â”‚  Puppeteer + Express            â”‚
    â”‚                                 â”‚
    â”‚  è¯»å–å½•åˆ¶æ•°æ® â†’ å›æ”¾ â†’ æˆªå›¾     â”‚
    â”‚  â†’ WebM ç¼–ç  â†’ ä¿å­˜è§†é¢‘         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ åŒ…è¯´æ˜

### 1. application (å‰ç«¯åº”ç”¨)
**æŠ€æœ¯æ ˆ**: Vue 3, Vite, rrweb, Ant Design Vue

**åŠŸèƒ½**:
- ç”¨æˆ·ç•Œé¢å±•ç¤º
- å½•åˆ¶ç”¨æˆ·æ“ä½œï¼ˆrrwebï¼‰
- å®æ—¶å›æ”¾å½•åˆ¶å†…å®¹
- è°ƒç”¨åç«¯ API ä¿å­˜æ•°æ®

**ç«¯å£**: 5173

### 2. server (å½•åˆ¶æ•°æ®æœåŠ¡) âœ¨ æ–°å¢
**æŠ€æœ¯æ ˆ**: Express, Node.js

**åŠŸèƒ½**:
- æ¥æ”¶å¹¶å­˜å‚¨å½•åˆ¶æ•°æ®
- ç®¡ç†å½•åˆ¶åˆ—è¡¨ï¼ˆCRUDï¼‰
- ç”Ÿæˆå›æ”¾ HTML é¡µé¢
- æä¾› RESTful API

**ç«¯å£**: 3000

### 3. rrwebToMp4 (è§†é¢‘è½¬æ¢æœåŠ¡)
**æŠ€æœ¯æ ˆ**: Puppeteer, Express, WebM Writer

**åŠŸèƒ½**:
- å¯åŠ¨æ— å¤´æµè§ˆå™¨
- å›æ”¾ rrweb å½•åˆ¶
- é€å¸§æˆªå›¾
- ç”Ÿæˆ WebM è§†é¢‘

**ç«¯å£**: 8888

### 4. rrweb (å°è£…åŒ…)
**æŠ€æœ¯æ ˆ**: TypeScript, rrweb

**åŠŸèƒ½**:
- å°è£… rrweb æ ¸å¿ƒåŠŸèƒ½
- æä¾›ç»Ÿä¸€æ¥å£

## ğŸ”„ æ•°æ®æµ

### å½•åˆ¶æµç¨‹
```
1. ç”¨æˆ·æ“ä½œ
   â†“
2. rrweb æ•è·äº‹ä»¶
   â†“
3. å­˜å‚¨åœ¨å†…å­˜ (events æ•°ç»„)
   â†“
4. ç‚¹å‡»"å›æ”¾"æŒ‰é’®
   â†“
5. rrweb-player å›æ”¾äº‹ä»¶
```

### ä¿å­˜åˆ°æœåŠ¡å™¨æµç¨‹
```
1. ç”¨æˆ·æ“ä½œ
   â†“
2. rrweb æ•è·äº‹ä»¶
   â†“
3. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
   â†“
4. HTTP POST /api/recording/save
   â†“
5. server æ¥æ”¶æ•°æ®
   â†“
6. ç”Ÿæˆ UUID
   â†“
7. ä¿å­˜åˆ° data/recordings/{uuid}.json
   â†“
8. æ›´æ–° index.json
   â†“
9. è¿”å› recordingId
```

### è§†é¢‘è½¬æ¢æµç¨‹
```
1. è¯»å–å½•åˆ¶æ–‡ä»¶
   â†“
2. å¯åŠ¨ Puppeteer
   â†“
3. åŠ è½½ replay.html
   â†“
4. å›æ”¾ rrweb äº‹ä»¶
   â†“
5. æ¯ 20ms æˆªå›¾
   â†“
6. WebM Writer ç¼–ç 
   â†“
7. ç”Ÿæˆ .webm æ–‡ä»¶
   â†“
8. ä¿å­˜åˆ° output/
```

## ğŸŒ API è®¾è®¡

### Server API

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è¯·æ±‚ä½“ | å“åº” |
|------|------|------|--------|------|
| POST | /api/recording/save | ä¿å­˜å½•åˆ¶ | {events, metadata} | {success, recordingId} |
| GET | /api/recording/list | è·å–åˆ—è¡¨ | - | {data, pagination} |
| GET | /api/recording/:id | è·å–å½•åˆ¶ | - | {data: recording} |
| DELETE | /api/recording/:id | åˆ é™¤å½•åˆ¶ | - | {success, message} |
| GET | /api/playback/:id | å›æ”¾é¡µé¢ | - | HTML |
| GET | /health | å¥åº·æ£€æŸ¥ | - | {status, uptime} |

### rrwebToMp4 API

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | / | å›æ”¾é¡µé¢ |
| POST | /uploadWebm | ä¸Šä¼  WebM |
| POST | /uploadMp4 | ä¸Šä¼  MP4 |

## ğŸ” å®‰å…¨è€ƒè™‘

### å½“å‰å®ç°
- âœ… CORS è·¨åŸŸæ§åˆ¶
- âœ… è¯·æ±‚ä½“å¤§å°é™åˆ¶
- âœ… è¾“å…¥ç±»å‹æ£€æŸ¥
- âœ… é”™è¯¯å¤„ç†

### ç”Ÿäº§ç¯å¢ƒéœ€è¦
- âš ï¸ HTTPS/SSL
- âš ï¸ ç”¨æˆ·è®¤è¯ (JWT/OAuth)
- âš ï¸ è¯·æ±‚é¢‘ç‡é™åˆ¶
- âš ï¸ è¾“å…¥éªŒè¯å’Œæ¸…ç†
- âš ï¸ SQL æ³¨å…¥é˜²æŠ¤ï¼ˆå¦‚ä½¿ç”¨æ•°æ®åº“ï¼‰
- âš ï¸ XSS é˜²æŠ¤

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å½“å‰ä¼˜åŒ–
- âœ… Gzip å‹ç¼©
- âœ… äº‹ä»¶åˆ†æ‰¹å¤„ç†ï¼ˆæ¯100ä¸ªä¸€æ‰¹ï¼‰
- âœ… å¼‚æ­¥æ–‡ä»¶æ“ä½œ

### å¯é€‰ä¼˜åŒ–
- ğŸ”„ Redis ç¼“å­˜
- ğŸ”„ æ•°æ®åº“ç´¢å¼•
- ğŸ”„ CDN é™æ€èµ„æº
- ğŸ”„ è´Ÿè½½å‡è¡¡
- ğŸ”„ æ•°æ®åº“è¯»å†™åˆ†ç¦»

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”

### å½“å‰æ–¹æ¡ˆï¼šæ–‡ä»¶ç³»ç»Ÿ
**ä¼˜ç‚¹**:
- ç®€å•æ˜“ç”¨
- æ— éœ€é…ç½®
- æ˜“äºå¤‡ä»½

**ç¼ºç‚¹**:
- æŸ¥è¯¢æ•ˆç‡ä½
- å¹¶å‘æ€§èƒ½å·®
- ä¸é€‚åˆå¤§è§„æ¨¡

**é€‚ç”¨**: å°å‹é¡¹ç›®ã€åŸå‹å¼€å‘

### å¯é€‰æ–¹æ¡ˆï¼šMongoDB
**ä¼˜ç‚¹**:
- çµæ´»çš„ schema
- è‰¯å¥½çš„æŸ¥è¯¢æ€§èƒ½
- æ”¯æŒç´¢å¼•å’Œèšåˆ

**é€‚ç”¨**: ä¸­å¤§å‹é¡¹ç›®

```javascript
// MongoDB Schema ç¤ºä¾‹
const recordingSchema = new mongoose.Schema({
  id: { type: String, unique: true },
  events: Array,
  metadata: {
    title: String,
    recordedAt: Date,
    duration: Number
  }
});
```

### å¯é€‰æ–¹æ¡ˆï¼šPostgreSQL
**ä¼˜ç‚¹**:
- ACID äº‹åŠ¡
- å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›
- JSON æ”¯æŒ

**é€‚ç”¨**: éœ€è¦å¤æ‚æŸ¥è¯¢çš„åœºæ™¯

## ğŸš€ éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
npm run dev          # å‰ç«¯
npm run dev:server   # åç«¯
cd package/rrwebToMp4 && npm start  # è§†é¢‘æœåŠ¡
```

### ç”Ÿäº§ç¯å¢ƒ

**å‰ç«¯**:
```bash
npm run build
# éƒ¨ç½²åˆ° Nginx/Apache
```

**åç«¯**:
```bash
# ä½¿ç”¨ PM2
pm2 start package/server/src/index.js --name "rrweb-server"
pm2 startup
pm2 save
```

**Nginx é…ç½®**:
```nginx
server {
    listen 80;
    server_name example.com;

    # å‰ç«¯
    location / {
        root /path/to/dist;
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ“ˆ æ‰©å±•æ€§

### æ°´å¹³æ‰©å±•
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nginx   â”‚ è´Ÿè½½å‡è¡¡
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–¶ Server Instance 1
     â”œâ”€â–¶ Server Instance 2
     â””â”€â–¶ Server Instance 3
          â”‚
          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ MongoDB â”‚ å…±äº«æ•°æ®åº“
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¾®æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–¶ å½•åˆ¶æœåŠ¡
       â”œâ”€â–¶ å›æ”¾æœåŠ¡
       â”œâ”€â–¶ è§†é¢‘æœåŠ¡
       â””â”€â–¶ ç”¨æˆ·æœåŠ¡
```

## ğŸ“ å¾…åŠäº‹é¡¹

### Phase 1 (MVP)
- [x] å‰ç«¯å½•åˆ¶åŠŸèƒ½
- [x] å‰ç«¯å›æ”¾åŠŸèƒ½
- [x] åç«¯å­˜å‚¨ API
- [x] è§†é¢‘è½¬æ¢åŠŸèƒ½
- [ ] ç”¨æˆ·æ–‡æ¡£å®Œå–„

### Phase 2 (å¢å¼º)
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] æ•°æ®åº“é›†æˆ
- [ ] æœç´¢åŠŸèƒ½
- [ ] æ•°æ®åˆ†æ

### Phase 3 (å¹³å°åŒ–)
- [ ] ç®¡ç†åå°
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] äº‘å­˜å‚¨é›†æˆ
- [ ] API SDK

## ğŸ“ å­¦ä¹ èµ„æº

- [rrweb å®˜æ–¹æ–‡æ¡£](https://www.rrweb.io/)
- [Express æ–‡æ¡£](https://expressjs.com/)
- [Puppeteer æ–‡æ¡£](https://pptr.dev/)
- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
- [RESTful API è®¾è®¡](https://restfulapi.net/)

