# ğŸ‰ é¡¹ç›®ä¿®å¤å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. macOS (Apple Silicon) å…¼å®¹æ€§ä¿®å¤
- âœ… Puppeteer ä» 5.5.0 å‡çº§åˆ° 13.7.0
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ç³»ç»Ÿ Chrome
- âœ… ä¿®å¤ Chrome å¯åŠ¨å‚æ•°ï¼ˆç§»é™¤ `--single-process`, `--no-zygote`ï¼‰
- âœ… æ·»åŠ å¿…è¦çš„ WASM æ”¯æŒå‚æ•°

### 2. ä¾èµ–å®‰è£…é—®é¢˜ä¿®å¤
- âœ… è§£å†³ pnpm 6.35.1 ä¸ Node.js 20.x ä¸å…¼å®¹é—®é¢˜
- âœ… ä½¿ç”¨ npm ä»£æ›¿ pnpm ä¸ºå­åŒ…å®‰è£…ä¾èµ–
- âœ… ç»•è¿‡ npm ç¼“å­˜æƒé™é—®é¢˜ï¼ˆä½¿ç”¨ä¸´æ—¶ç¼“å­˜ç›®å½•ï¼‰
- âœ… ä¸ºæ‰€æœ‰å­åŒ…æˆåŠŸå®‰è£…ä¾èµ–

### 3. è§†é¢‘ç¼–ç é—®é¢˜ä¿®å¤
- âœ… H264 WASM ç¼–ç å™¨ä¸ç¨³å®š â†’ åˆ‡æ¢åˆ° WebM Writer
- âœ… ä¿®å¤ canvas API å…¼å®¹æ€§é—®é¢˜
- âœ… å®ç° base64 åˆ° canvas çš„æ­£ç¡®è½¬æ¢
- âœ… è¾“å‡ºæ ¼å¼ï¼šWebMï¼ˆæ›´ç¨³å®šå¯é ï¼‰

### 4. æ–‡æ¡£å®Œå–„
- âœ… æ›´æ–°ä¸» README.md
- âœ… åˆ›å»ºè¯¦ç»†çš„ PROJECT_INFO.md
- âœ… æ›´æ–° rrwebToMp4/README.md
- âœ… åˆ›å»º NPM_CONFIG_FIX.md é…ç½®æŒ‡å—
- âœ… åˆ›å»ºå¿«é€Ÿå¯åŠ¨è„šæœ¬ quick-start.sh

## ğŸ“ é¡¹ç›®ç»“æ„

```
webRocord/
â”œâ”€â”€ package/
â”‚   â”œâ”€â”€ application/          # âœ… å‰ç«¯åº”ç”¨ (Vue 3)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue    # é¦–é¡µ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ from.vue     # è¡¨å•æ¼”ç¤ºé¡µï¼ˆå½•åˆ¶/å›æ”¾ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ router/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ rrweb/               # âœ… rrweb å°è£…åŒ…
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚
â”‚   â””â”€â”€ rrwebToMp4/          # âœ… è§†é¢‘è½¬æ¢æœåŠ¡
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.js     # æµè§ˆå™¨ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ page.js      # é¡µé¢æˆªå›¾
â”‚       â”‚   â””â”€â”€ server.js    # Express æœåŠ¡å™¨
â”‚       â”œâ”€â”€ public/
â”‚       â”‚   â””â”€â”€ upload/      # è§†é¢‘è¾“å‡ºç›®å½•
â”‚       â”œâ”€â”€ replay.html      # å›æ”¾é¡µé¢ (WebM ç¼–ç å™¨)
â”‚       â”œâ”€â”€ README.md
â”‚       â””â”€â”€ PROJECT_INFO.md
â”‚
â”œâ”€â”€ README.md                # âœ… ä¸»æ–‡æ¡£
â”œâ”€â”€ quick-start.sh          # âœ… å¿«é€Ÿå¯åŠ¨è„šæœ¬
â””â”€â”€ package.json
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1ï¼šä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
./quick-start.sh
```

è„šæœ¬ä¼šï¼š
1. æ£€æŸ¥ Node.js å’Œ Chrome
2. è‡ªåŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–
3. æä¾›å¯åŠ¨é€‰é¡¹èœå•

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# å¯åŠ¨å‰ç«¯åº”ç”¨
npm run dev
# è®¿é—® http://localhost:5173/#/from

# æµ‹è¯•è§†é¢‘è½¬æ¢
cd package/rrwebToMp4
npm test
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### å‰ç«¯åº”ç”¨ (http://localhost:5173/)

**é¦–é¡µ** (`/#/`)
- ç®€å•ä»‹ç»é¡µ
- è·³è½¬åˆ°è¡¨å•æ¼”ç¤ºé¡µ

**è¡¨å•æ¼”ç¤ºé¡µ** (`/#/from`)
- âœ… ç‚¹å‡»"å½•åˆ¶"æŒ‰é’®å¼€å§‹å½•åˆ¶ç”¨æˆ·æ“ä½œ
- âœ… æ“ä½œè¡¨å•ï¼ˆè¾“å…¥å§“åã€é€‰æ‹©æ€§åˆ«ã€å‹¾é€‰çˆ±å¥½ã€å¡«å†™ä»‹ç»ï¼‰
- âœ… ç‚¹å‡»"å›æ”¾"å®æ—¶æŸ¥çœ‹å½•åˆ¶å†…å®¹
- âœ… å½•åˆ¶æ§åˆ¶å°æ—¥å¿—ï¼ˆæ”¯æŒ info/log/warn/errorï¼‰
- âœ… æ‰‹åŠ¨æŠ›é”™åŠŸèƒ½ï¼ˆç”¨äºæµ‹è¯•é”™è¯¯å½•åˆ¶ï¼‰

### è§†é¢‘è½¬æ¢æœåŠ¡ (rrwebToMp4)

```bash
cd package/rrwebToMp4
npm test
```

æ‰§è¡Œæµç¨‹ï¼š
1. å¯åŠ¨ Puppeteer æ— å¤´æµè§ˆå™¨ï¼ˆä½¿ç”¨ç³»ç»Ÿ Chromeï¼‰
2. å¯åŠ¨ Express æœåŠ¡å™¨ (http://127.0.0.1:8888)
3. åŠ è½½ replay.html å›æ”¾é¡µé¢
4. æ’­æ”¾ rrweb å½•åˆ¶æ•°æ®
5. æ¯ 20ms æˆªå›¾ä¸€æ¬¡
6. ä½¿ç”¨ WebM Writer ç¼–ç 
7. ç”Ÿæˆ .webm è§†é¢‘æ–‡ä»¶
8. ä¿å­˜åˆ° `public/upload/webm/`

## ğŸ’» æŠ€æœ¯æ ˆ

### å‰ç«¯
- **Vue 3** (Composition API)
- **Vite** 6.0.1
- **Ant Design Vue** 4.x
- **rrweb** 1.1.0
- **rrweb-player** 1.0.0-alpha.4
- **Vue Router** 4.3.0

### åç«¯/è§†é¢‘è½¬æ¢
- **Node.js** 20.19.4
- **Puppeteer** 13.7.0
- **Express** 4.17.1
- **WebM Writer** (å†…ç½®)
- **Multer** 1.4.3

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å½•åˆ¶æ€§èƒ½
- **äº‹ä»¶æ•°é‡**: æ¯ 100 ä¸ªäº‹ä»¶åˆ¶ä½œä¸€æ¬¡å¿«ç…§
- **æ•°æ®å¤§å°**: å–å†³äºæ“ä½œå¤æ‚åº¦
- **å†…å­˜å ç”¨**: é€‚ä¸­

### è§†é¢‘è½¬æ¢æ€§èƒ½
- **å¸§ç‡**: 50 FPS
- **å¤„ç†é€Ÿåº¦**: çº¦ 20ms/å¸§
- **ç¤ºä¾‹**: 9ç§’å½•åˆ¶ â†’ 139å¸§ â†’ çº¦2.8ç§’å¤„ç†
- **è¾“å‡ºæ ¼å¼**: WebM
- **æ–‡ä»¶å¤§å°**: å–å†³äºåˆ†è¾¨ç‡å’Œæ—¶é•¿

## ğŸ”§ é…ç½®é€‰é¡¹

### å½•åˆ¶é…ç½® (application/src/views/from.vue)

```javascript
record({
  checkoutEveryNth: 100,        // æ¯ 100 ä¸ªäº‹ä»¶é‡æ–°åˆ¶ä½œå¿«ç…§
  plugins: [
    getRecordConsolePlugin({
      level: ["info", "log", "warn", "error"],
      lengthThreshold: 10000,
      stringifyOptions: {
        stringLengthLimit: 1000,
        numOfKeysLimit: 100,
        depthOfLimit: 1
      }
    })
  ]
})
```

### è§†é¢‘é…ç½® (rrwebToMp4/replay.html)

```javascript
let config = {
  fps: 50,          // å¸§ç‡ (30-60 æ¨è)
  width: 480,       // ä»å½•åˆ¶æ•°æ®è‡ªåŠ¨è·å–
  height: 800       // ä»å½•åˆ¶æ•°æ®è‡ªåŠ¨è·å–
};
```

### Chrome å¯åŠ¨å‚æ•° (rrwebToMp4/src/index.js)

```javascript
args: [
  '--no-sandbox',
  '--disable-setuid-sandbox',
  '--disable-dev-shm-usage',
  '--no-first-run',
  '--disable-gpu',
  '--enable-features=SharedArrayBuffer',
  '--js-flags=--experimental-wasm-simd'
]
```

## ğŸ› å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: pnpm å®‰è£…å¤±è´¥
**ç°è±¡**: `ERR_INVALID_THIS`
**åŸå› **: pnpm 6.35.1 ä¸ Node.js 20.x ä¸å…¼å®¹
**è§£å†³**: ä½¿ç”¨ npm ä»£æ›¿ pnpmï¼Œæˆ–å‡çº§ pnpm åˆ° 8.x

### é—®é¢˜ 2: npm ç¼“å­˜æƒé™é”™è¯¯
**ç°è±¡**: `EACCES: permission denied`
**åŸå› **: npm ç¼“å­˜ç›®å½•æƒé™é—®é¢˜
**è§£å†³**: ä½¿ç”¨ä¸´æ—¶ç¼“å­˜ `--cache /tmp/npm-cache`

### é—®é¢˜ 3: Puppeteer æ‰¾ä¸åˆ° Chrome
**ç°è±¡**: `spawn /usr/bin/chromium-browser ENOENT`
**åŸå› **: macOS ä¸Š Chrome è·¯å¾„ä¸åŒ
**è§£å†³**: ä»£ç å·²è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿ Chrome è·¯å¾„

### é—®é¢˜ 4: Chrome å¯åŠ¨åç«‹å³å´©æºƒ
**ç°è±¡**: `ProtocolError: Target closed`
**åŸå› **: `--single-process` å‚æ•°åœ¨ macOS ä¸Šä¸å…¼å®¹
**è§£å†³**: å·²ç§»é™¤ä¸å…¼å®¹å‚æ•°

### é—®é¢˜ 5: H264 WASM ç¼–ç å™¨å¤±è´¥
**ç°è±¡**: `RuntimeError: abort(undefined)`
**åŸå› **: WASM åœ¨æ— å¤´ Chrome ä¸­ä¸ç¨³å®š
**è§£å†³**: æ”¹ç”¨ WebM Writer (çº¯ JavaScript)

## ğŸ“ˆ åç»­æ”¹è¿›å»ºè®®

### çŸ­æœŸ
1. æ·»åŠ æ›´å¤šå½•åˆ¶ç¤ºä¾‹é¡µé¢
2. å®ç°è§†é¢‘ä¸‹è½½åŠŸèƒ½
3. æ·»åŠ è§†é¢‘è´¨é‡é€‰é¡¹
4. ä¼˜åŒ–è§†é¢‘æ–‡ä»¶å¤§å°

### ä¸­æœŸ
1. æ”¯æŒå®æ—¶é¢„è§ˆå½•åˆ¶
2. æ·»åŠ è§†é¢‘ç¼–è¾‘åŠŸèƒ½ï¼ˆè£å‰ªã€åˆå¹¶ï¼‰
3. æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼å¯¼å‡ºï¼ˆMP4, WebM, GIFï¼‰
4. æ·»åŠ äº‘å­˜å‚¨é›†æˆ

### é•¿æœŸ
1. æ„å»º SaaS å¹³å°
2. æ·»åŠ ç”¨æˆ·ç®¡ç†å’Œæƒé™æ§åˆ¶
3. å®ç°è§†é¢‘åˆ†äº«åŠŸèƒ½
4. æä¾› API æ¥å£

## ğŸ“ å­¦ä¹ èµ„æº

- [rrweb å®˜æ–¹æ–‡æ¡£](https://www.rrweb.io/)
- [Puppeteer æ–‡æ¡£](https://pptr.dev/)
- [WebM æ ¼å¼è¯´æ˜](https://www.webmproject.org/)
- [Vue 3 æ–‡æ¡£](https://vuejs.org/)

## ğŸ‘¥ è´¡çŒ®è€…

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„äººï¼

## ğŸ“„ è®¸å¯è¯

ISC License

---

**æœ€åæ›´æ–°**: 2025-12-31
**é¡¹ç›®çŠ¶æ€**: âœ… å¯ç”¨ä¸”ç¨³å®š

