# rrweb-to-mp4 é¡¹ç›®è¯´æ˜

## ğŸ¬ åŠŸèƒ½
å°† rrweb å½•åˆ¶çš„æ“ä½œæ•°æ®è½¬æ¢ä¸ºè§†é¢‘æ ¼å¼ï¼ˆWebMï¼‰

## âœ… å½“å‰é…ç½®

### è§†é¢‘æ ¼å¼
- **è¾“å‡ºæ ¼å¼**: WebM
- **ç¼–ç å™¨**: WebM Writer (çº¯ JavaScript)
- **å¸§ç‡**: 50 FPS
- **è¯´æ˜**: æ”¾å¼ƒäº† H264 MP4 ç¼–ç å™¨ï¼ˆWASMï¼‰ï¼Œå› ä¸ºåœ¨ Puppeteer æ— å¤´ Chrome ç¯å¢ƒä¸‹ä¸ç¨³å®š

### æŠ€æœ¯æ ˆ
- **Puppeteer 13.7.0**: æ”¯æŒ macOS ARM64 (Apple Silicon)
- **Express**: æä¾›æœ¬åœ°æœåŠ¡å™¨ (http://127.0.0.1:8888)
- **rrweb**: å½•åˆ¶å’Œå›æ”¾å¼•æ“
- **WebM Writer**: è§†é¢‘ç¼–ç åº“

### ç³»ç»Ÿè¦æ±‚
- Node.js 18+
- macOS (å·²å®‰è£… Google Chrome)
- æˆ–ä»»ä½•æ”¯æŒ Puppeteer çš„ç³»ç»Ÿ

## ğŸš€ ä½¿ç”¨æ–¹æ³•

```bash
# æµ‹è¯•
npm test

# è¿™å°†ä¼š:
# 1. å¯åŠ¨ Puppeteer (ä½¿ç”¨ç³»ç»Ÿ Chrome)
# 2. å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
# 3. å›æ”¾ rrweb äº‹ä»¶
# 4. é€å¸§æˆªå›¾
# 5. ç”Ÿæˆ WebM è§†é¢‘
# 6. ä¸Šä¼ åˆ°æœåŠ¡å™¨
```

## ğŸ“ è¾“å‡ºæ–‡ä»¶

- **è§†é¢‘æ–‡ä»¶**: `public/upload/webm/*.webm`
- **æˆªå›¾åºåˆ—**: `output/*.jpeg` (è°ƒè¯•ç”¨)

## ğŸ”§ é…ç½®

### Chrome å¯åŠ¨å‚æ•° (src/index.js)
```javascript
args: [
  '--no-sandbox',
  '--disable-setuid-sandbox',
  '--disable-dev-shm-usage',
  '--no-first-run',
  '--disable-gpu',
  '--enable-features=SharedArrayBuffer',
  '--js-flags=--experimental-wasm-simd'
]
```

### è§†é¢‘é…ç½® (replay.html)
```javascript
let config = {
  width: 480,   // ä»å½•åˆ¶æ•°æ®è‡ªåŠ¨è·å–
  height: 800,  // ä»å½•åˆ¶æ•°æ®è‡ªåŠ¨è·å–
  fps: 50       // å¸§ç‡
};
```

## ğŸ› å·²è§£å†³çš„é—®é¢˜

1. âœ… Puppeteer 5.5.0 ä¸æ”¯æŒ ARM64 â†’ å‡çº§åˆ° 13.7.0
2. âœ… pnpm å…¼å®¹æ€§é—®é¢˜ â†’ ä½¿ç”¨ npm
3. âœ… Chrome å¯åŠ¨å‚æ•°å¯¼è‡´å´©æºƒ â†’ ç§»é™¤ `--single-process`
4. âœ… H264 WASM ç¼–ç å™¨ä¸ç¨³å®š â†’ æ”¹ç”¨ WebM Writer
5. âœ… canvas API å…¼å®¹æ€§ â†’ ä½¿ç”¨ Image + Canvas è½¬æ¢

## ğŸ“ æ³¨æ„äº‹é¡¹

- WebM æ˜¯æ ‡å‡†è§†é¢‘æ ¼å¼ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ
- å¦‚éœ€ MP4 æ ¼å¼ï¼Œå¯ä½¿ç”¨ ffmpeg åç«¯è½¬æ¢
- è§†é¢‘å¤§å°å–å†³äºå½•åˆ¶æ—¶é•¿å’Œå¸§ç‡
- å»ºè®®å¸§ç‡ä¿æŒåœ¨ 30-60 FPS

## ğŸ”„ å·¥ä½œæµç¨‹

```
rrweb å½•åˆ¶æ•°æ® 
  â†’ Puppeteer å›æ”¾ 
  â†’ é€å¸§æˆªå›¾ (JPEG base64)
  â†’ Canvas è½¬æ¢
  â†’ WebM Writer ç¼–ç 
  â†’ ç”Ÿæˆ .webm æ–‡ä»¶
  â†’ ä¸Šä¼ åˆ°æœåŠ¡å™¨
```

## ğŸ“¦ ä¾èµ–åŒ…

æ ¸å¿ƒä¾èµ–:
- puppeteer: ^13.7.0
- express: ^4.17.1
- multer: ^1.4.3
- progress: ^2.0.3

## ğŸ¯ ä¸å‰ç«¯é›†æˆ

å‰ç«¯åº”ç”¨ (application åŒ…) å¯ä»¥:
1. ä½¿ç”¨ rrweb å½•åˆ¶ç”¨æˆ·æ“ä½œ
2. å°†äº‹ä»¶æ•°æ®å‘é€åˆ°æ­¤æœåŠ¡
3. æ­¤æœåŠ¡ç”Ÿæˆè§†é¢‘å¹¶è¿”å›ä¸‹è½½é“¾æ¥

